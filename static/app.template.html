<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<!-- Pure CSS -->
		<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
		<!--[if lte IE 8]>
			<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/grids-responsive-old-ie-min.css">
		<![endif]-->
		<!--[if gt IE 8]><!-->
		<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/grids-responsive-min.css">
		<!--<![endif]-->

		<!-- Font Awesome -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

		<!-- Our own CSS -->
		<link rel="stylesheet" href="static/app.css">

		<!-- Dependencies and code to plot the investment graph -->
		<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/flot/0.8.2/jquery.flot.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/flot/0.8.2/jquery.flot.time.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/flot.tooltip/0.8.5/jquery.flot.tooltip.js"></script>
		<script type="text/javascript">
function formatNumber(n, preSymbol, postSymbol) {
	nStr = preSymbol + ' ' + n;
	x = nStr.split('.');
	x1 = x[0];
	x2 = x.length > 1 ? '.' + x[1] : '';
	var rgx = /(\d+)(\d{3})/;
	while (rgx.test(x1)) {
		x1 = x1.replace(rgx, '$1' + ',' + '$2');
	}
	return x1 + x2 + ' ' + postSymbol;
}

function formatCurrency(n) {
	return formatNumber(n, '{{.Currency}}', '')
}

function formatPercent(n) {
	return formatNumber(n, '', '%')
}
var amountSummaryData = [[{{range .AmountSummaryChart}}{{.}},{{end}}]];
var interestRateData = [[{{range .InterestRateChart}}{{.}},{{end}}]];
var options = {
	series: {
		shadowSize: 5,
		points: { show: true },
		lines: {show: true},
	},
	grid: { 
		hoverable: true, 
		clickable: true,
	},
	legend: {
		position: "nw",
	},
	xaxis: {
		mode: "time",
		timeformat: "%m/%Y",
		tickSize: [1, "month"],
	},
	tooltip : true,
};
aSummaryOptions = JSON.parse(JSON.stringify(options))
aSummaryOptions.yaxis =  {
	tickFormatter: formatCurrency,
	axisLabel: "Total Amount ({{.Currency}})",
},
irateChartOptions = JSON.parse(JSON.stringify(options))
irateChartOptions.yaxis =  {
	tickSize: 0.25,
	tickFormatter: formatPercent,
	axisLabel: "Interest Rate (%)",
}
$(document).ready(function() {
	$.plot("#summChart", amountSummaryData, aSummaryOptions);
	$.plot("#irateChart", interestRateData, irateChartOptions);
});
		</script>
	</head>
	<body>
		<div class="pure-g">
			<div class="pure-u-1 pure-u-md-1-3">
				<div class="operation-container">
					<form method="post" class="pure-form pure-form-aligned">
						<fieldset class="pure-group">
							<legend>Interest Rate</legend>
							<div id="irateChart"></div>
						</fieldset>
					</form>
				</div>
			</div>
			<div class="pure-u-1 pure-u-md-1-3">
				<div class="operation-container">
					<form method="post" class="pure-form pure-form-aligned">
						<fieldset class="pure-group">
							<legend>Total Amount</legend>
							<div id="summChart"></div>
						</fieldset>
					</form>
				</div>
			</div>
		</div>
		<div class="pure-g">
			<div class="pure-u-1 pure-u-md-1-3">
				<div class="operation-container">
					<form action="op" method="post" class="pure-form pure-form-aligned">
						<fieldset class="pure-group">
							<legend>Add Operation</legend>

							<select name="type" class="pure-input-1-2" required>
								<option value="">Type</option>
								<option value="1">Balance</option>
								<option value="2">Deposit</option>
								<option value="3">Withdrawal</option>
							</select>

							<select name="inv" class="pure-input-1-2" required>
								<option value="">Investment</option>
								{{range .Investments}}
								<option value="{{.Key}}">{{.Name}}</option>
								{{end}}
							</select>

							<input name="value" type="text" size="10" class="pure-input-1-2" placeholder="Value" required>
							<input name="date" type="date" class="pure-input-1-2" placeholder="Date" required>

							<button type="submit" name="action" class="pure-button pure-input-1-2 pure-button-primary">
								<i class="fa fa-plus"></i>
								Add
							</button>
						</fieldset>
					</form>
				</div>
			</div>

			<div class="pure-u-1 pure-u-md-1-3">
				<div class="operation-container">
					<form action="inv" method="post" class="pure-form pure-form-aligned">
						<fieldset>
							<legend>Investments</legend>
							<select name="key" class="pure-input-1-2">
								<option value="">Investment</option>
								{{range .Investments}}
								<option value="{{.Key}}">{{.Name}}</option>
								{{end}}
							</select>
							<input name="name" type="text" size="15" class="pure-input-1-2" placeholder="Name">						 
							<button type="submit" name="action" value="ae" class="pure-button pure-input-1-2 pure-button-primary">
								<i class="fa fa-edit"></i>
								New/Edit
							</button>
							<button type="submit" name="action" value="d" class="pure-button pure-input-1-2">
								<i class="fa fa-trash-o"></i>
								Delete
							</button>
						</fieldset>
					</form>
				</div>
			</div>

			<div class="pure-u-1 pure-u-md-1-3">
				<div class="operation-container">
					<form action="listops" method="post" class="pure-form pure-form-aligned">
						<fieldset>
							<legend>List Operations</legend>
							<select name="inv" class="pure-input-1-2" required>
								<option value="">Investment</option>
								{{range .Investments}}
								<option value="{{.Key}}">{{.Name}}</option>
								{{end}}
							</select>
							<button type="submit" name="action" class="pure-button pure-input-1-2 pure-button-primary">
								<i class="fa fa-list"></i>
								List
							</button>
						</fieldset>
					</form>
				</div>
			</div>
		</div>

		<div class="pure-g">
			<div class="pure-u-1">
				{{range .Investments}}
				<ul class="fa-ul">
					<li><i class="fa-li fa fa-bank"></i>{{.Name}}</li>
					<ul class="fa-ul">
						{{range .Ops.Summarize}}
						<script>
balance = formatCurrency({{.Balance}});
change = formatCurrency({{.Change}});
document.write("<li><i class='fa-li fa fa-bar-chart'></i>{{.Date.Format "2006/01"}} || Balance:" + balance + " || Change:" + change);
						</script>
						{{end}}
					</ul>
				</ul>
				{{end}}
			</div>
		</div>

		<div class="pure-g">
			<div class="pure-u-1">
				<a href={{.LogoutURL}} class="pure-button">
					<i class="fa fa-sign-out fa-flip-horizontal"></i>
					Logout
				</a>
			</div>
		</div>
	</body>
</html>
